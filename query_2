GENERO MAIS VENDIDO E VALOR TOTAL
MOST SOLD GENRE AND TOTAL VALUE


SELECT *
FROM (
	SELECT GENERO
		,PAIS
		,TOTAL
		,ROW_NUMBER() OVER (
			PARTITION BY PAIS ORDER BY TOTAL DESC
			) AS RANKING
	FROM (
		SELECT G.NAME AS GENERO
			,IV.BILLING_COUNTRY AS PAIS
			,SUM(TOTAL) AS TOTAL
		FROM INVOICE AS IV
		LEFT JOIN INVOICE_LINE AS IL ON IV.INVOICE_ID = IL.INVOICE_ID
		LEFT JOIN TRACK AS T ON IL.TRACK_ID = T.TRACK_ID
		LEFT JOIN GENRE AS G ON T.GENRE_ID = G.GENRE_ID
		GROUP BY 1
			,2
		ORDER BY TOTAL DESC
		) AS A
	) B
WHERE RANKING = 1 -- FILTRAMOS APENAS PELOS MAIS VENDIDOS
ORDER BY TOTAL DESC
